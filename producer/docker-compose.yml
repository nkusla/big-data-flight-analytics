services:
  flight-producer:
    build: .
    container_name: flight-producer
    hostname: flight-producer
    environment:
      PYTHONUNBUFFERED: "1"
    networks:
      - pipeline-network
    volumes:
      - ./data:/app/data:rw
      - ./.env:/app/.env:ro
    # Bouding box of parts of Texas, USA
    # Min lat, Max lat, Min lon, Max lon
    # --bbox 28.990724 31.925941 -99.063721 -94.471436
    command: >
      python producer.py
      --mode file
      --bootstrap-servers kafka-broker-1:9092,kafka-broker-2:9092
      --topic flights-data
      --partition-size 20
      --interval 30
    restart: no

networks:
  pipeline-network:
    name: pipeline-network
    external: true

# Note: kafka-broker-1 and kafka-broker-2 are expected to be running
# in the stream-cluster. Start them first with:
# cd ../stream-cluster && docker-compose up -d
